# Decision Log

Этот файл записывает архитектурные и реализационные решения в формате списка.
2026-01-12 18:38:00 - Последняя редакция базового описания.

## Правила редактирования

* Записи в разделах должны быть отсортированы в обратном хронологическом порядке (самые новые сверху, старые внизу).
* Каждая запись должна начинаться с даты редакции в формате ГГГГ-ММ-ДД ЧЧ:ММ:СС.
2026-01-12 18:38:00 - Последняя редакция правил редактирования.

## Записи MCP

## Решение: Проблема форматов данных при реранжировании
2025-04-11 05:17:38 - Решение: Проблема форматов данных при реранжировании
### Обоснование
* Обнаружено: элементы теряются при передаче между search_similar_items и reranker
* Причина: несоответствие форматов данных (list vs dict)
### Детали реализации
* Добавлено детальное логирование форматов
* Унифицированы форматы элементов
* Ревью архитектуры взаимодействия компонентов
* Валидация форматов данных на границах

## Решение: Исправление ошибки embeddings
2025-04-07 23:32:45 - Решение: Исправление ошибки embeddings
### Обоснование
* Добавлена функция count_tokens в embeddings.py для корректного подсчета токенов при семантическом разбиении текста
### Детали реализации
* Функция использует tiktoken.encoding_for_model()
* Исправлена ошибка с отсутствующей функцией count_tokens

## Решение: Рефакторинг обработки форматов данных в retrieval.py
2025-04-07 09:28:36 - Решение: Рефакторинг обработки форматов данных в retrieval.py
### Обоснование
* Добавлена функция get_text() для унифицированного доступа к тексту
* Поддержаны оба формата данных (явное поле 'text' и item['item'][2])
* Сохранена обратная совместимость
* Исправлена ошибка KeyError: 'text' и IndexError
### Детали реализации
* Все тесты проходят успешно

## Решение: Система оценки качества
2025-04-07 09:10:34 - Решение: Система оценки качества
### Обоснование
* Внедрение метрик precision@k, recall, NDCG
* Объективная оценка качества поиска и генерации
### Детали реализации
* evaluation.py, тестовые сценарии в tests/

## Решение: Реранжирование результатов с кросс-энкодером
2025-04-07 00:20:00 - Решение: Реранжирование результатов с кросс-энкодером
### Обоснование
* Использование bge-reranker-base для улучшения порядка результатов поиска
* Повышение релевантности топовых результатов
### Детали реализации
* retrieval.py, кэширование результатов

## Решение: Семантическое чанкование документов
2025-04-07 00:20:00 - Решение: Семантическое чанкование документов
### Обоснование
* Разбиение документов по смысловым границам с перекрывающимися чанками
* Улучшение качества контекста для генерации ответов
### Детали реализации
* embeddings.py, параметры чанков в config.py

## Решение: Реализация гибридного поиска (векторный + BM25)
2025-04-07 00:20:00 - Решение: Реализация гибридного поиска (векторный + BM25)
### Обоснование
* Комбинация векторного поиска (text-embedding-3-large) и текстового поиска (BM25) с настраиваемыми весами
* Улучшение точности поиска за счет комбинации семантического и лексического поиска
### Детали реализации
* retrieval.py, параметры в config.py

## Решение: Синхронизация Git и окончания строк
2025-03-30 20:10:09 - Решение: Синхронизация Git и окончания строк
### Обоснование
* Устранение проблем с окончаниями строк (CRLF/LF) при совместной работе на Windows и Linux
### Детали реализации
* **Глобальная конфигурация Git:** `git config --global core.autocrlf input` для Linux/macOS

## Решение: Использование технологии RAG
2025-03-29 16:02:00 - Решение: Использование технологии RAG
### Обоснование
* RAG позволяет генерировать ответы на основе конкретной базы знаний, что повышает точность и релевантность ответов
### Детали реализации
* Выбор PostgreSQL в качестве базы данных для хранения элементов и эмбеддингов
* Использование моделей OpenAI для генерации эмбеддингов и ответов
* Реализация кэширования эмбеддингов для повышения производительности
* Создание иерархической структуры данных с родительскими и дочерними элементами
* Разработка интерактивного режима отладки с возможностью настройки параметров

^1: 2025-03-29 16:02:00 - Инициализация файла с решениями.
^2: 2026-01-12 18:38:00 - Реструктуризация файла согласно инструкциям.